<html>

<head>
    <meta charset="utf-8">
    <title>Roads I've Travelled</title>

    <link href='https://fonts.googleapis.com/css?family=Roboto:400,700' rel='stylesheet' type='text/css'>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-statistics/0.9.0/simple_statistics.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/1.10.0/d3-legend.min.js"></script>

    <style>
        /*        body {*/
        /*
            margin: 0;
            padding: 0;
            background: whitesmoke;
            font-family: "Robato", sans-serif;
*/
        /*
        }
        
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
        
        #ui-slider {
            position: absolute;
            bottom: 20px;
            left: 36%;
            width: 200px;
            padding: 8px 15px 4px;
            background: #1C9976;
            border-radius: 3px;
            color: whitesmoke;
        }
        
        .slider {
            width: 100%;
        }
*/
        /*
        #grade {
            position: absolute;
            bottom: 60px;
            left: 36%;
            padding: 6px 15px 8px;
            background: whitesmoke;
            border: 2px solid #1C9976;
            padding: 6px 15px 8px;
            border-radius: 3px;
            color: #1C9976;
            font-size: 1em;
        }
        
        #grade span {
            font-size: 1.3em;
            font-weight: 500;
        }
        
        #legend {
            position: absolute;
            right: 15px;
            bottom: 20px;
            padding: 8px 15px;
            background: whitesmoke;
            border: 2px solid #1C9976;
            border-radius: 3px;
            color: #1C9976;
            width: 160px;
            height: 220px;
        }
        
        #legend h3 {
            text-align: right;
            font-weight: 500;
            margin: 10px 0 20px;
        }
        
        #info {
            padding: 8px 15px;
            background: whitesmoke;
            border: 2px solid #1C9976;
            border-radius: 3px;
            color: #1C9976;
            position: absolute;
            font-size: 1em;
            max-width: 200px;
            display: none;
             so doesn't appear when page loads 
        }
        
        #info p {
            margin: 3px 0 4px;
        }
        
        #info span:last-child {
            font-size: 1.3em;
            font-weight: 500;
        }
        
        #side-panel {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 33%;
            background: whitesmoke;
            border-left: 2px solid #1C9976;
            overflow-y: scroll;
        }
        
        h1 {
            padding: 8px 25px 8px 15px;
            margin: 0;
            background: grey;
            color: black;
            font-weight: 700;
            font-size: 1.5em;
            text-align: center;
        }
        
        h2 {
            margin: 0;
            padding: 8px 25px 8px 15px;
            color: #f2b632;
            font-weight: 700;
            font-size: 1.2em;
            text-align: right;
        }
        
        #side-panel p {
            margin: 8px 0 4px;
            padding: 0 25px 0 15px;
            color: #677077;
            text-align: right;
            font-size: 1em;
            font-weight: 400;
        }
        
        #side-panel p:after {
            content: '';
            display: block;
            clear: both;
        }
        
        #side-panel img {
            float: right;
            margin: 0 0 15px 15px;
        }
        
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            width: 67%;
        }
*/
        
        #container {
            position: relative;
            z-index: 100;
            height: 100vh;
            overflow: scroll;
        }
        
        #sticky {
            position: absolute;
            top: 5vh;
            right: 0;
            width: 48%;
            z-index: 50;
        }
        
        .panel {
            width: 100%;
            padding-left: 20px;
            padding-top: 25vh;
            padding-bottom: 25vh;
        }
        
        .panel p {
            padding-right: 50%;
        }
        
        .panel:first-child {
            padding-top: 5vh;
        }
        
        .panel:last-child {
            padding-bottom: 45vh;
        }
    </style>
</head>

<body>

    <body>
        <div id='sticky'></div>
        <div id='container'>
            <div id='content'>
                <div class="panel">

                    <h1>Roads I've Travelled</h1>
                    <h2>Use Scroll bar to see more</h2>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam mollis laoreet elementum. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Donec mi eros, rutrum sed orci eget, venenatis varius est. Pellentesque accumsan est vitae risus malesuada fringilla.</p>
                    <p>Cras at massa in leo aliquam fermentum. Nunc auctor vestibulum sagittis. Aliquam pulvinar, ipsum in pulvinar tincidunt, enim metus fermentum tellus, quis accumsan ex lorem ut ante. Phasellus fermentum orci eget interdum ultrices. Proin vitae magna id odio ultricies placerat quis id ex. Aenean volutpat volutpat gravida.</p>
                    <p>Cras at massa in leo aliquam fermentum. Nunc auctor vestibulum sagittis. Aliquam pulvinar, ipsum in pulvinar tincidunt, enim metus fermentum tellus, quis accumsan ex lorem ut ante. Phasellus fermentum orci eget interdum ultrices. Proin vitae magna id odio ultricies placerat quis id ex. Aenean volutpat volutpat gravida.</p>
                    <p>Cras at massa in leo aliquam fermentum. Nunc auctor vestibulum sagittis. Aliquam pulvinar, ipsum in pulvinar tincidunt, enim metus fermentum tellus, quis accumsan ex lorem ut ante. Phasellus fermentum orci eget interdum ultrices. Proin vitae magna id odio ultricies placerat quis id ex. Aenean volutpat volutpat gravida.</p>
                </div>
                <script>
                    var WIDTH = 0.9 * window.innerWidth / 2;
                    var HEIGHT = 0.9 * window.innerHeight;

                    var svg = d3.select("#sticky").append("svg")
                        .attr('width', WIDTH)
                        .attr('height', HEIGHT);

                    var body = d3.select('body').node();
                    var container = d3.select('#container');
                    var content = d3.select('#content');

                    var SCROLL_LENGTH = content.node().getBoundingClientRect().height - HEIGHT;

                    var hayanPathScale = d3.scale.linear()
                        .domain([0, SCROLL_LENGTH])
                        .range([0, haiyanPath.node().getTotalLength()])
                        .clamp(true);

                    container
                        .on("scroll.scroller", function () {
                            newScrollTop = container.node().scrollTop
                        });

                    var setDimensions = function () {
                        WIDTH = window.innerWidth / 2;
                        HEIGHT = window.innerHeight;
                        SCROLL_LENGTH = content.node().getBoundingClientRect().height - HEIGHT;

                        projection.scale(6 * (WIDTH + 1) / 2 / Math.PI)
                            .translate([WIDTH / 2, HEIGHT / 2]);

                        path.projection(projection);

                        landPath.attr("d", path);
                        countriesPath.attr("d", path);
                        graticulePath.attr("d", path);

                        haiyanPath
                            .attr("d", pathLine(track));

                        hayanPathScale
                            .domain([0, SCROLL_LENGTH])
                            .range([0, haiyanPath.node().getTotalLength()]);

                        haiyanPath
                            .style('stroke-dasharray', function (d) {
                                var l = d3.select(this).node().getTotalLength();
                                return l + 'px, ' + l + 'px';
                            })
                            .style('stroke-dashoffset', function (d) {
                                return d3.select(this).node().getTotalLength() - hayanPathScale(scrollTop) + 'px';
                            });
                    }

                    var render = function () {
                        if (scrollTop !== newScrollTop) {
                            scrollTop = newScrollTop
                            haiyanPath
                                .style('stroke-dashoffset', function (d) {
                                    return haiyanPath.node().getTotalLength() - hayanPathScale(scrollTop) + 'px';
                                });

                        }


                        window.requestAnimationFrame(render)
                    }
                    window.requestAnimationFrame(render)

                    window.onresize = setDimensions


                    // custom JS goes here


                    //
                    //                    var width = 900
                    //                        , height = 600;
                    //
                    //
                    //                    var svg = d3.select("#map") // select the document's body
                    //                        .append("svg") // create and append a new svg element to it
                    //                        .attr("width", width) // give the svg width
                    //                        .attr("height", height); // give the svg height
                    //
                    //
                    //                    var projection = d3.geo.albers() // create a new d3 projection function, albers equal area
                    //                        .scale(1000) // play with the scale until it's 'zoomed' about right
                    //                        .parallels([30, 50])
                    //                        .center([-3, 39.7])
                    //                        .translate([width / 2, height / 2]); // center the svg (0,0 is top, left)
                    //
                    //                    var geoPath = d3.geo.path() //  create a new geo path generator
                    //                        .projection(projection); // assign the project we just created to it
                    //
                    //                    queue()
                    //                        .defer(d3.json, "https://dbartley.cartodb.com/api/v2/sql?format=GeoJSON&q=SELECT * FROM cancerdeaths_bycounty_copy")
                    //                        .defer(d3.json, 'na_land_clipped.json')
                    //                        .await(makeMap);
                    //
                    //
                    //
                    //
                    //                    function makeMap(error, counties, na) {
                    //
                    //
                    //
                    //                        svg.append("g")
                    //                            .selectAll("path")
                    //                            .data(counties.features)
                    //                            .enter()
                    //                            .append("path")
                    //                            .attr("d", geoPath)
                    //                            .attr("class", "county")
                    //                            .attr("fill", function (d) {
                    //                                if (!d.properties.cancer_deaths_rate) {
                    //                                    return '#d3d3d3';
                    //                                }
                    //
                    //                                return jenks(d.properties.cancer_deaths_rate);
                    //                            })
                    //                            .on("mouseover", function (d) {
                    //                                d3.select("h2").text(d.properties.cancer_deaths_county + " Cancer Death Rate : " + d.properties.cancer_deaths_rate);
                    //                                d3.select(this).attr("class", "county hover");
                    //                                console.log(d);
                    //                            })
                    //                            .on("mouseout", function (d) {
                    //                                d3.select("h2").text("Choose County to See Death Rate");
                    //                                d3.select(this).attr("class", "county");
                    //                            });
                    //
                    //
                    //
                    //                        //                script below creates a legend. Note that I just made a custom ordinal legend based off the colors and breaks from above. However, you can also feed in the scale used and the legend library will automatically generate it for you
                    //                        var linear = d3.scale.ordinal()
                    //                            .domain([65.3, 154.3, 182.9, 212.8, 376.2])
                    //                            .range(["#feedde", "#fdbe85", "#fd8d3c", "#e6550d", "#a63603"]);
                    //
                    //
                    //                        svg.append("g")
                    //                            .attr("class", "legendLinear")
                    //                            .attr("transform", "translate(20,20)");
                    //
                    //                        var legendLinear = d3.legend.color()
                    //                            .shapeWidth(60)
                    //                            .orient('vertical')
                    //                            .scale(linear) //used the linear scale from above, because feeding in the jenks scale used to symbolize the map has funny text for the values at the top and bottom
                    //                            .title("Deaths per 100,000");
                    //
                    //
                    //                        svg.select(".legendLinear")
                    //                            .call(legendLinear);
                    //
                    //                    };
                </script>
    </body>

</html>